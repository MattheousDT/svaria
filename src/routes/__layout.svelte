<script lang="ts" context="module">
	import type { Load } from "@sveltejs/kit";
	import { init, register, waitLocale } from "svelte-intl-precompile";

	// @ts-expect-error
	register("en", () => import("$locales/en"));
	// @ts-expect-error
	register("es", () => import("$locales/es"));
	// @ts-expect-error
	register("ko", () => import("$locales/ko"));

	export const load: Load = async ({ session }) => {
		init({
			fallbackLocale: "en",
			initialLocale: session.locale,
		});
		await waitLocale();
		return {};
	};
</script>

<script lang="ts">
	import shortcut from "$lib/actions/shortcut";
	import type { IShortcut } from "svaria";
	import Nav from "$site/components/nav.svelte";
	import Shortcuts from "$site/components/shortcuts.svelte";
	import { shortcutsVisibility } from "$site/stores/prefs";

	let navHeight: string;

	let globalShortcuts: IShortcut[] = [
		{
			name: "Toggle shortcuts",
			description: "Show/hide the shortcuts list",
			key: "/",
			callback: () => shortcutsVisibility.update((x) => (x = !x)),
		},
	];
</script>

<svelte:body use:shortcut={globalShortcuts} />

<Nav bind:height={navHeight} />
<main style:padding-top={navHeight}>
	<slot />
</main>
<footer>Made with ‚ù§ in Belfast</footer>
<Shortcuts />

<style lang="scss" global>
	@import "global";
	@import "variables";

	#svelte {
		background-color: $sand;
		min-height: 100vh;
		display: flex;
		flex-direction: column;
	}

	main {
		flex: 1;
	}

	footer {
		padding: 1rem;
		display: flex;
		align-items: center;
		justify-content: center;
	}
</style>
